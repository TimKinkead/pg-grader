"use strict";try{var app=angular.module("app",["ui.router","ui.bootstrap","ngResource","ngSanitize","divResizer","angularResizable"]);app.config(["$locationProvider","$urlRouterProvider",function(a,b){a.html5Mode({enabled:!0,requireBase:!0}),b.otherwise("/")}]),window.ie9&&!window.location.hash&&window.location.pathname.length<=1&&(console.log("IE 9 requires # for client side routing."),window.location.assign("/#/"+window.location.search))}catch(e){console.log(e),window.location.assign("/unsupported")}angular.module("app").config(["$stateProvider",function(a){a.state("home",{url:"/",templateUrl:"modules/main/home/view.html",controller:"HomeController"}),a.state("welcome",{url:"/welcome",templateUrl:"modules/main/welcome/view.html",controller:"WelcomeController",data:{memberOnly:!0}}),a.state("user",{template:"<div ui-view></div>",controller:"UserController","abstract":!0}),a.state("user.signup",{url:"/sign-up",templateUrl:"modules/main/user/views/sign-up.html",data:{guestOnly:!0}}),a.state("user.login",{url:"/login",templateUrl:"modules/main/user/views/login.html",data:{guestOnly:!0}}),a.state("user.settings",{url:"/settings",templateUrl:"modules/main/user/views/settings.html",data:{memberOnly:!0}}),a.state("user.forgotpassword",{url:"/forgot-password",templateUrl:"modules/main/user/views/forgot-password.html",data:{guestOnly:!0}}),a.state("user.resetpassword",{url:"/reset-password",templateUrl:"modules/main/user/views/reset-password.html",data:{guestOnly:!0}}),a.state("essays",{url:"/essays?all-essays-graded&modal-check&essay",templateUrl:"modules/main/essays/view.html",controller:"EssaysController",data:{memberOnly:!0}}),a.state("grade",{url:"/grade?scoresheet&essay",templateUrl:"modules/main/grade/view.html",controller:"GradeController",data:{memberOnly:!0}}),a.state("graders",{url:"/graders",templateUrl:"modules/main/graders/view.html",controller:"GradersController",data:{adminOrFacilitator:!0}}),a.state("graded-work",{url:"/graded-work",templateUrl:"modules/main/graded-work/view.html",controller:"GradedWorkController",data:{memberOnly:!0}}),a.state("consensus-scores",{url:"/consensus-scores",templateUrl:"modules/main/consensus-scores/view.html",controller:"ConsensusScoresController",data:{memberOnly:!0}}),a.state("download",{url:"/download",templateUrl:"modules/main/download/view.html",controller:"DownloadController"}),a.state("admin",{url:"/admin",templateUrl:"modules/main/admin/view.html",controller:"AdminController"})}]),angular.module("app").config(["$httpProvider",function(a){a.defaults.headers["delete"]={"Content-Type":"application/json;charset=utf-8"},a.defaults.cache=!1,a.defaults.headers.get||(a.defaults.headers.get={}),a.defaults.headers.get["If-Modified-Since"]="0"}]),angular.module("app").run(["$rootScope","$state","CurrentUser",function(a,b,c){function d(){return Boolean(c.data&&c.data._id)}function e(){return Boolean(d()&&c.data.admin)}function f(){return Boolean(d()&&c.data.facilitator)}a.$on("$stateChangeStart",function(a,c,g,h,i){c.data&&c.data.guestOnly&&d()?(a.preventDefault(),b.go("home")):c.data&&c.data.memberOnly&&!d()?(a.preventDefault(),b.go("home")):c.data&&c.data.adminOrFacilitator&&!e()&&!f()?(a.preventDefault(),b.go("home")):c.data&&c.data.adminOnly&&!e()&&(a.preventDefault(),b.go("home"))})}]),angular.module("app").run(["$location",function(a){"_=_"===a.hash()&&a.url(a.path())}]),angular.module("app").service("CurrentUser",["$window",function(a){return{data:a.user||{}}}]),angular.module("divResizer",[]).directive("resizer",function(a){return function(b,c,d){function e(b){if("vertical"===d.resizer){var e=b.pageX;d.resizerMax&&e>d.resizerMax&&(e=parseInt(d.resizerMax)),c.css({left:e+"px"}),a.$attrs.resizerLeft.css({width:e+"px"})}else{var f=window.innerHeight-b.pageY;c.css({bottom:f+"px"})}}function f(){a.unbind("mousemove",e),a.unbind("mouseup",f)}c.on("mousedown",function(b){b.preventDefault(),a.on("mousemove",e),a.on("mouseup",f)})}}),angular.module("app").directive("fixedSizeFullHeight",["$window",function(a){return{restrict:"C",link:function(b,c,d){function e(){var b=c[0]?c[0]:c,d=b.parentNode.children,e=Array.prototype.indexOf.call(b.parentNode.children,b),f=d.length>1&&0!==e?b.parentNode.children[e-1]:document.getElementById("main-nav"),g=f.getBoundingClientRect().bottom;b.style.minHeight=Math.floor(a.innerHeight-g)+"px"}e(),angular.element(a).bind("resize",e),b.$on("$destroy",function(){angular.element(a).unbind("resize",e)})}}}]),angular.module("app").filter("averageScore",[function(){return function(a){if(!a)return null;var b,c=0,d=0;for(var e in a)a.hasOwnProperty(e)&&"number"==typeof a[e]&&(c+=a[e],d++);if(!c||!d)return null;if(b=Math.round(c/d*100)/100,b=b.toString(),b.indexOf(".")<0)b+=".00";else for(;b.length-(b.indexOf(".")+1)<2;)b+="0";return b}}]),angular.module("app").filter("capitalize",[function(){return function(a){if(!a)return"";if("string"!=typeof a)return a;for(var b="",c=!0,d=0,e=a.length;d<e;d++)/[^a-zA-Z0-9\/\&]/.test(a[d])?(b+=" ",c=!0):(b+=c?a[d].toUpperCase():a[d].toLowerCase(),c=!1);var f=["BPA","UN"];if(f.indexOf(b)>-1)return b.toUpperCase();f.forEach(function(a){var c=new RegExp("(^"+a+"\\s|\\s"+a+"\\s|\\s"+a+"$)","i");b.match(c)&&(b=b.replace(c," *"+a+"* "))});for(var g=/(\s\s|\*)/;b.match(g);)b=b.replace(g," ");return b=b.trim()}}]),angular.module("app").filter("percentage",[function(){return function(a){return a||0===a?(a=Number(a),Math.round(100*a)+"%"):""}}]),angular.module("app").filter("roughNumber",[function(){return function(a){var b=a;return b>=1e3&&b<1e4?(b=Math.round(b/100)/10,b+="k"):b>=1e4&&b<1e6?(b=Math.round(b/1e3),b+="k"):b>=1e6&&b<1e7?(b=Math.round(b/1e5)/10,b+="M"):b>=1e7&&(b=Math.round(b/1e6),b+="M"),b}}]),angular.module("app").controller("NavbarController",["$scope","$window","CurrentUser",function(a,b,c){a.user=c.data,a.window=b,a.toggleNavbar=function(){angular.element(document.getElementById("navbar-collapse")).toggleClass("in")},a.logout=function(a){a&&a.preventDefault(),window.location.assign("/data/user/logout")}}]),angular.module("app").directive("navbar",[function(){return{restrict:"A",templateUrl:"modules/parts/navbar/view.html",scope:{},controller:"NavbarController"}}]),angular.module("app").controller("AdminController",["$scope","$resource","$http","$window","CurrentUser",function(a,b,c,d,e){var f=a.user=e.data,g=a.status={errorMessages:[],successMessages:[]},h=a.data={},i=a.collections=["error","essay","group","module","rubric","scoresheet","user"];a.initCollections=["rubric","module","group","essay"];i.forEach(function(a){h[a]={}}),a.closeErrorMessage=function(a){g.errorMessages.splice(a,1)},a.closeSuccessMessage=function(a){g.successMessages.splice(a,1)};var j=a.count=function(a){g["counting"+a]=!0,c.get("/data/"+a+"/count",{}).success(function(b){g["counting"+a]=!1,h[a].count=Number(b)}).error(function(b){g["counting"+a]=!1,g.errorMessages.push("Error counting "+a+" docs!")})};i.forEach(function(a){j(a)});a.initialize=function(a){if(d.location.host.indexOf("localhost")<0&&h[a].count&&!f.admin)return void g.errorMessages.push("You don't have permission to initialize the "+a+" collection.");g["initializing"+a]=!0;var b="essay"===a?5e3:1e3;c.get("/data/"+a+"/init",{}).success(function(){g.successMessages.push("Initializing "+a+" collection."),setTimeout(function(){g["initializing"+a]=!1,j(a)},b)}).error(function(b){g["initializing"+a]=!1,g.errorMessages.push("Error initializing "+a+" collection!")})}}]),angular.module("app").controller("ConsensusScoresController",["$scope","$resource","$http","$timeout","$uibModal","$state","CurrentUser",function(a,b,c,d,e,f,g){var h=a.status={},i=(a.params={},a.errorMessages=[]),j=a.successMessages=[];a.fields=["no","date","grader","essay","rubric","score","edit"];a.user=g.data,a.closeErrorMessage=function(a){i.splice(a,1)},a.closeSuccessMessage=function(a){j.splice(a,1)},h.processing=!0;var k=a.scoresheets=b("data/scoresheet/list-consensus").query({},function(){h.processing=!1},function(a){h.processing=!1,i.push(a&&a.message?a.message:"Error! We had trouble retrieving the consensus scores. Please try refreshing the page.")});a.viewDetails=function(a){var b=e.open({templateUrl:"modules/main/consensus-scores/modal/view.html",controller:"ConsensusScoresModalController",size:"xl",resolve:{scoresheets:function(){var b=[];return k.forEach(function(c){c.essay.id===a&&b.push(c)}),b}}});b.result.then(function(){console.log("close")},function(a){console.log("dismiss")})},a.$watch("params.param",function(a,b){a!==b&&console.log(a)})}]),angular.module("app").controller("ConsensusScoresModalController",["$scope","$uibModalInstance","scoresheets",function(a,b,c){a.scoresheets=c;var d=a.fields=["grader","rubric"];c.forEach(function(a){for(var b in a.score)a.score.hasOwnProperty(b)&&d.indexOf(b)<0&&d.push(b)}),a.cancel=function(){b.dismiss()}}]),angular.module("app").controller("DownloadController",["$scope","$window","$uibModal",function(a,b,c){function d(b){setTimeout(function(){e.successMessage=null,a.$digest()},b)}var e=a.status={};a.closeErrorMessage=function(){e.errorMessage=null},a.closeSuccessMessage=function(){e.successMessage=null},a.downloadGradedWorkCSV=function(){b.location.href="http://"+b.location.host+"/data/scoresheet/download",e.successMessage="Download in progress.",d(3e3)},a.downloadGradedWorkTSV=function(){b.location.href="http://"+b.location.host+"/data/scoresheet/download?delimiter=tab",e.successMessage="Download in progress.",d(3e3)},a.downloadGradedWorkSRI=function(){b.location.href="http://"+b.location.host+"/data/scoresheet/download/sri",e.successMessage="Download in progress.",d(5e3)}}]),angular.module("app").controller("EssaysController",["$scope","$rootScope","$resource","$http","$timeout","$uibModal","$state","$stateParams","$window","CurrentUser",function(a,b,c,d,e,f,g,h,i,j){function k(a){var b={beingGradedBy:0,beingGradedByYou:!1,skippedBy:0,skippedByYou:!1,wasGradedBy:0,wasGradedByYou:!1,yourScoreSheet:null,masterScoreSheet:null};return a.graders&&a.graders.length&&a.graders.forEach(function(a){b.beingGradedBy++,a.toString()===m._id.toString()&&(b.beingGradedByYou=!0)}),a.skip&&a.skip.length&&a.skip.forEach(function(a){b.skippedBy++,a.user&&a.user.toString()===m._id.toString()&&(b.skippedByYou=!0)}),a.scoresheets&&a.scoresheets.length&&a.scoresheets.forEach(function(a){a.masterScore?b.masterScoreSheet=a:b.wasGradedBy++,a.user&&a.user.toString()===m._id.toString()&&(b.wasGradedByYou=!0,b.yourScoreSheet=a)}),b}function l(a){var b;switch(n.essayFilterBy){case"all essays":b=!0;break;case"master scores":b=Boolean(a.masterScoreSheet);break;case"graded essays":b=Boolean(a.wasGradedBy);break;case"ungraded essays":b=Boolean(!a.wasGradedBy);break;case"my essays":b=Boolean(a.wasGradedByYou||a.beingGradedByYou);break;default:b=!0}return n.moduleFilterBy&&a.module._id!==n.moduleFilterBy&&(b=!1),b}var m=a.user=j.data,n=a.status={essayFilterBy:m.admin||m.facilitator?"all essays":"my essays",moduleFilterBy:null},o=(a.params={},a.errorMessages=[]),p=a.successMessages=[],q=(a.essayFilterOptions=m.admin||m.facilitator?["all essays","master scores","graded essays","ungraded essays","my essays"]:["my essays","all essays"],i.location.host.indexOf("localhost")>-1?1e4:3e4),r=a.essays=[],s=a.modules=[];a.fields=m.admin||m.facilitator?["no","id","module","master score","being graded by","skipped by","graded by","grade quota","grade"]:["no","id","module","master score","grading in progress","skipped by you","graded by you","graded","grade"];a.closeErrorMessage=function(a){o.splice(a,1)},a.closeSuccessMessage=function(a){p.splice(a,1)};var t=function v(){console.log("refreshEssays"),"essays"===g.current.name&&d.get("data/essay/list",{}).success(function(a){var b={};a.forEach(function(a){b[a._id]=k(a)}),r.forEach(function(a){var c=b[a._id];c&&(a=angular.extend(a,c))}),setTimeout(v,q)}).error(function(a){console.log(a)})};n.processingEssays=!0,r=a.essays=c("data/essay/list").query({},function(){n.processingEssays=!1,r.forEach(function(a){a=angular.extend(a,k(a)),a.visible=l(a)}),setTimeout(t,q)},function(a){n.processingEssays=!1,o.push(a&&a.message?a.message:"Error! We had trouble listing the essays. Please try refreshing the page.")}),n.processingModules=!0,s=a.modules=c("data/module/list").query({},function(){n.processingModules=!1},function(a){n.processingModules=!1}),a.viewDetails=function(a){var b=f.open({templateUrl:"modules/main/essays/modal-detail/view.html",controller:"EssayDetailModalController",size:"xl",resolve:{essayId:function(){return a}}});b.result.then(function(){console.log("close")},function(a){console.log("dismiss")})};var u=a.checkMasterScore=function(a){var b=f.open({templateUrl:"modules/main/essays/modal-check/view.html",controller:"MasterScoreModalController",size:"xl",resolve:{essayId:function(){return a}}});b.result.then(function(){console.log("close")},function(a){console.log("dismiss")})};a.gradeButtonNgClass=function(a){var b={};return a.beingGradedByYou?b["btn-danger"]=!0:a.wasGradedByYou?b["btn-info"]=!0:(a.gradeAll||a.beingGradedBy||a.wasGradedBy||a.skippedByYou)&&(!a.gradeAll||a.wasGradedByYou||a.skippedByYou)||(b["btn-success"]=!0),b},a.gradeButtonText=function(a){return a.beingGradedByYou&&a.wasGradedByYou?"finish editing":a.beingGradedByYou?"finish grading":a.wasGradedByYou?"edit score":"grade now"},h["all-essays-graded"]&&(n.allEssaysGraded=!0,h["all-essays-graded"]=null,g.go(g.$current,h,{notify:!1,reload:!1})),h["modal-check"]&&(h.essay&&u(h.essay),h["modal-check"]=null,h.essay=null,g.go(g.$current,h,{notify:!1,reload:!1})),a.$watch("status.essayFilterBy",function(a,b){a!==b&&(n.processingEssays=!0,r.forEach(function(a){a.visible=l(a)}),n.processingEssays=!1)}),a.$watch("status.moduleFilterBy",function(a,b){a!==b&&(n.processingEssays=!0,r.forEach(function(a){a.visible=l(a)}),n.processingEssays=!1)})}]),angular.module("app").controller("MasterScoreModalController",["$scope","$uibModalInstance","$resource","CurrentUser","essayId",function(a,b,c,d,e){var f=a.user=d.data,g=a.status={},h=a.essay=null,i=a.scoresheets=[],j=a.fields=["grader"];a.cancel=function(){b.dismiss()},h=a.essay=c("data/essay").get({essay:e,full:!0},function(){var a={};h.gradedBy.forEach(function(b){b&&b._id&&(a[b._id]=b)}),h.scoresheets.forEach(function(b){if(f.admin||f.facilitator||b.masterScore||b.user.toString()===f._id.toString()){b.user=a[b.user],i.push(b);for(var c in b.score)b.score.hasOwnProperty(c)&&j.indexOf(c)<0&&j.push(c)}})},function(a){g.errorMessage="We had trouble loading the scores. Please try again."})}]),angular.module("app").controller("EssayDetailModalController",["$scope","$uibModalInstance","$resource","CurrentUser","essayId",function(a,b,c,d,e){var f=a.user=d.data,g=a.status={},h=a.essay=null,i=a.scoresheets=[],j=a.fields=["grader"];a.cancel=function(){b.dismiss()},h=a.essay=c("data/essay").get({essay:e,full:!0},function(){var a={};h.gradedBy.forEach(function(b){b&&b._id&&(a[b._id]=b)}),h.scoresheets.forEach(function(b){if(f.admin||f.facilitator||b.masterScore||b.user.toString()===f._id.toString()){b.user=a[b.user],i.push(b);for(var c in b.score)b.score.hasOwnProperty(c)&&j.indexOf(c)<0&&j.push(c)}})},function(a){g.errorMessage="We had trouble loading the scores. Please try again."})}]),angular.module("app").controller("GradeController",["$scope","$resource","$http","$uibModal","$window","$state","$stateParams","$sce","CurrentUser",function(a,b,c,d,e,f,g,h,i){function j(a){a.returnValue=y}function k(){e.addEventListener?e.addEventListener("beforeunload",j):e.attachEvent("onbeforeunload",j)}function l(){e.removeEventListener?e.removeEventListener("beforeunload",j):e.detachEvent("onbeforeunload",j)}function m(){if(x.rubric){var a,b;if("show all"===u.rubricElements)for(a=0,b=x.rubric.fields.length;a<b;a++)x.rubric.fields[a].visible=!0;else{var c=!1;for(a=0,b=x.rubric.fields.length;a<b;a++)c||w.score[x.rubric.fields[a].name]||0!==a&&!w.score[x.rubric.fields[a-1].name]?x.rubric.fields[a].visible=!1:(x.rubric.fields[a].visible=!0,c=!0)}}}function n(){[v,w,x].forEach(function(a){for(var b in a)a.hasOwnProperty(b)&&(a===x&&"rubrics"===b?x.rubrics=x.rubrics||null:a===w&&"score"===b?w.score={}:a[b]=null)}),g.scoresheet=null,g.essay=null,l()}function o(){v.processingEssay=!0,c.get("/data/essay?essay="+w.essay+"&grading=true").success(function(b){setTimeout(function(){v.processingEssay=!1,a.$digest()},1e3),v.masterScore=b.masterScore,x.essay=b,x.essay.iframeLink=h.trustAsResourceUrl("https://docs.google.com/gview?url="+b.link+"&embedded=true"),w.rubric||(w.rubric=b.module.rubric),!w.scoresheet&&b.scoresheets&&b.scoresheets.forEach(function(a){a.user&&a.user.toString()===u._id.toString()&&!a.masterScore&&(w.scoresheet=a._id)})}).error(function(a){v.processingEssay=!1,errorModal("We had trouble loading the essay. Please try again.")})}function p(){n(),v.processingEssay=!0,c.get("/data/essay/next").success(function(a){if("all essays graded"===a.message){var b=d.open({templateUrl:"modules/main/grade/modal/done.html",controller:"GradeModalController",backdrop:"static"});return void b.result.then(function(){f.go("essays",{"all-essays-graded":!0})},function(){f.go("essays",{"all-essays-graded":!0})})}v.newModule=a.newModule,v.masterScore=a.masterScore,v.consensusScore=a.consensusScore,w.essay=a._id}).error(function(a){v.processingEssay=!1,errorModal("We had trouble loading the essay. Please try again.")})}function q(){if(x.rubrics)for(var a=0,b=x.rubrics.length;a<b;a++)if(w.rubric===x.rubrics[a]._id){x.rubric=x.rubrics[a],x.rubric.fields.forEach(function(a){a.details.forEach(function(a){a.texts=a.text?a.text.split("\n"):null})}),m();break}}function r(){v.processingRubrics=!0,x.rubrics=b("/data/rubric/list").query({},function(){v.processingRubrics=!1,w.rubric&&q()},function(a){v.processingRubrics=!1,errorModal("We had trouble getting the list of rubrics. Please close the modal and try again.")})}function s(){v.processingScoreSheet=!0,c.get("/data/scoresheet?scoresheet="+w.scoresheet).success(function(a){v.processingScoreSheet=!1,v.saved=!0,v.formValid=!0,x.scoresheet=!0,w.essay=a.essay._id,w.rubric=a.rubric._id,w.score=a.score,l()}).error(function(a){v.processingScoreSheet=!1,errorModal("We had trouble loading your score sheet. Please try again.")})}function t(){var a=!1;["scoresheet","essay"].forEach(function(b){w[b]!==g[b]&&(g[b]=w[b],a=!0)}),a&&(g.scoresheet&&(g.essay=null),f.go(f.$current,g,{notify:!1,reload:!1}))}var u=a.user=i.data,v=a.status={nextEssay:null,hidePrompt:null,saved:null,newModule:null},w=a.params={scoresheet:null,user:u._id,essay:null,rubric:null,score:{}},x=a.docs={scoresheet:null,essay:null,rubric:null,rubrics:null};g.scoresheet?w.scoresheet=g.scoresheet:g.essay?w.essay=g.essay:v.nextEssay=!0,a.errorModal=function(a,b){a&&!b&&(b=a,a=null),a||(a="Error!"),b||(b="Something went wrong. Please try again.");var c=d.open({templateUrl:"modules/main/grade/modal/error.html",controller:"GradeModalErrorController",resolve:{info:function(){return{header:a,message:b}}}});c.result.then(function(){console.log("close")},function(){console.log("dismiss")})};var y="Warning!\n\nYour work has not been saved.\nAre you sure you want to leave this page?\n";a.$on("$stateChangeStart",function(a,b,c,d,e){v.saved===!1&&(confirm(y)||a.preventDefault())}),a.$on("$destroy",function(a){l()}),a.switchSides=function(){u.rubricSide="right"===u.rubricSide?"left":"right",c.put("/data/user/settings",{rubricSide:u.rubricSide}).success(function(){console.log("rubricSide updated")}).error(function(a){console.log("error updating rubricSide")})},a.switchRubricElements=function(a){u.rubricElements=a,m(),c.put("/data/user/settings",{rubricElements:u.rubricElements}).success(function(){console.log("rubricElements updated")}).error(function(a){console.log("error updating rubricElements")})},a.switchPrompt=function(){v.hidePrompt=!v.hidePrompt};var z=a.updateRubricTableWidth=function(){v.rubricTableWidth=document.getElementById("rubric-table").clientWidth};a.$on("angular-resizable.resizeEnd",function(a,b){z()}),angular.element(e).bind("resize",function(){z()}),a.nextEssay=function(){v.nextEssay=!0},a.skip=function(){var a=d.open({templateUrl:"modules/main/grade/modal/skip.html",controller:"GradeModalController",backdrop:"static"});a.result.then(function(a){v.processingSkip=!0,c.put("/data/essay/skip",{essay:w.essay,reason:a}).success(function(){v.processingSkip=!1,f.go("essays")}).error(function(a){v.processingSkip=!1,f.go("essays")})},function(a){console.log(a||"dismiss")})},a.scoreField=function(a,b,c){w.score[b]=c,m(),k(),v.saved=!1;a:{for(var d=0,e=x.rubric.fields.length;d<e;d++)if(!w.score[x.rubric.fields[d].name]){v.formValid=!1;break a}v.formValid=!0}},a.editField=function(a){for(var b=0,c=x.rubric.fields.length;b<c;b++)x.rubric.fields[b].visible=b===a},a.clickSave=function(){if(v.formValid)return!0;v.clickSave=!0;var a=d.open({templateUrl:"modules/main/grade/modal/invalid.html",controller:"GradeModalController"});return a.result.then(function(){console.log("close")},function(){console.log("dismiss")}),!1},a.save=function(){v.processingSave=!0,c.post("/data/scoresheet",w).success(function(a){v.processingSave=!1,v.saved=!0,l(),u.scoresheets++;var b;return v.masterScore?(b=d.open({templateUrl:"modules/main/grade/modal/check.html",controller:"GradeModalController",backdrop:"static"}),void b.result.then(function(b){u.checkScores++,b?"check-scores"===b?f.go("essays",{"modal-check":!0,essay:a.essay}):f.go(b):v.nextEssay=!0},function(){u.checkScores++,w.scoresheet=a._id})):(b=d.open({templateUrl:"modules/main/grade/modal/next.html",controller:"GradeModalController",backdrop:"static"}),void b.result.then(function(a){return a?void f.go(a):void(v.nextEssay=!0)},function(){w.scoresheet=a._id}))}).error(function(a){v.processingSave=!1,errorModal("We had trouble saving your score sheet. Please try again.")})},a.$watch("status.nextEssay",function(a,b){!a||a===b&&x.essay||p()}),a.$watch("params.scoresheet",function(a,b){!a||a===b&&x.scoresheet||(t(),s())}),a.$watch("params.essay",function(a,b){!a||a===b&&x.essay||(t(),o())}),a.$watch("params.rubric",function(a,b){a&&a!==b&&(b&&(v.saved=!1,k()),x.rubrics?q():r())}),a.initializeGradeDashboard=function(){console.log("init")}}]),angular.module("app").controller("GradeModalErrorController",["$scope","$uibModalInstance","info",function(a,b,c){a=angular.extend(a,c),a.cancel=function(){b.dismiss()}}]),angular.module("app").controller("GradeModalController",["$scope","$uibModalInstance",function(a,b){var c=a.status={},d=a.params={};a.cancel=function(){b.dismiss()},a.nextEssay=function(){b.close()},a.backToEssays=function(){b.close("essays")},a.clickSkip=function(){return c.clicked=!0,!0},a.skip=function(){b.close(d.reason)},a.reviewMasterScores=function(){b.close("check-scores")},a.reviewConsensusScores=function(){b.close("consensus-scores")}}]),angular.module("app").controller("GradedWorkController",["$scope","$resource","$http","$timeout","$uibModal","$state","CurrentUser",function(a,b,c,d,e,f,g){var h=a.status={},i=(a.params={},a.errorMessages=[]),j=a.successMessages=[],k=(a.fields=["no","date","grader","essay","rubric","score"],a.user=g.data);a.closeErrorMessage=function(a){i.splice(a,1)},a.closeSuccessMessage=function(a){j.splice(a,1)},h.processing=!0;var l=a.scoresheets=b("data/scoresheet/list").query({},function(){h.processingTopics=!1},function(a){h.processingTopics=!1,i.push(a&&a.message?a.message:"Error! We had trouble listing the graded work. Please try refreshing the page.")});a.newScoreSheet=function(){var a=e.open({templateUrl:"modules/main/graded-work/create/view.html",controller:"GradedWorkCreateController",backdrop:"static",size:"xl"});a.result.then(function(a){l.push(a)},function(a){console.log(a||"dismiss")})},a.editOrView=function(a){if(a.user._id===k._id)f.go("grade",{scoresheet:a._id});else{var b=e.open({templateUrl:"modules/main/graded-work/preview/view.html",controller:"GradedWorkPreviewController",size:"xl",resolve:{scoresheet:function(){return a}}});b.result.then(function(){console.log("close")},function(){console.log("dismiss")})}},a.editScoreSheet=function(a,b){var c=e.open({templateUrl:"modules/main/graded-work/edit/view.html",controller:"GradedWorkEditController",backdrop:"static",size:"xl",resolve:{scoresheet:function(){return a}}});c.result.then(function(a){l[b]=a},function(a){console.log(a||"dismiss")})},a.skippedEssays=b("data/essay/list-skipped").query(),a.$watch("params.param",function(a,b){a!==b&&console.log(a)})}]),angular.module("app").controller("GradedWorkCreateController",["$scope","$uibModalInstance","$http","$resource","CurrentUser",function(a,b,c,d,e){var f=a.user=e.data,g=a.status={},h=a.params={grader:null,studentWorkId:null,rubric:null,score:{}},i=a.rubric=null,j=a.rubrics=[];a.cancel=function(){b.dismiss("cancel")},a.closeErrorMessage=function(){g.errorMessage=null},f.admin?(g.processingGraders=!0,a.graders=d("/data/user/list").query({namesOnly:!0},function(){g.processingGraders=!1},function(a){g.processingGraders=!1,g.errorMessage=a&&a.message?a.message:"We had trouble listing the graders. Please close the modal and try again."})):h.grader=f._id,g.processingRubrics=!0,j=a.rubrics=d("/data/rubric/list").query({},function(){g.processingRubrics=!1},function(a){g.processingRubrics=!1,g.errorMessage=a&&a.message?a.message:"We had trouble getting the list of rubrics. Please close the modal and try again."}),a.getRubric=function(){return g.errorMessage=null,h.studentWorkId?void(g.getRubric=!0):void(g.errorMessage="Please enter a student work id.")},a.scoreField=function(a,b,c){i.fields[a+1]&&!h.score[i.fields[a+1].name]&&(i.fields[a+1].visible=!0),h.score[b]=c,i.fields[a].visible=!1,g.clicked=!1;a:{for(var d=0,e=i.fields.length;d<e;d++)if(!h.score[i.fields[d].name]){g.formValid=!1;break a}g.formValid=!0}},a.editField=function(a){i.fields[a].visible=!0},a.click=function(){return g.clicked=!0,!0},a.save=function(){g.formValid&&(g.processing=!0,console.log(JSON.stringify(h,null,4)),c.post("data/scoresheet",h).success(function(a){g.processing=!1,a.user=f,a.rubric=i,b.close(a)}).error(function(a){g.processing=!1,g.errorMessage=a&&a.message?a.message:"We had trouble saving your score sheet. Please try again."}))},a.$watch("params.rubric",function(b,c){if(b!==c)for(var d=0,e=j.length;d<e;d++)if(b===j[d]._id){i=a.rubric=j[d],i.fields[0].visible=!0;break}})}]),angular.module("app").controller("GradedWorkEditController",["$scope","$uibModalInstance","$http","$resource","CurrentUser","scoresheet",function(a,b,c,d,e,f){var g=a.user=e.data,h=a.status={},i=a.params=f,j=a.rubric=null,k=a.rubrics=[];a.cancel=function(){b.dismiss("cancel")},a.closeErrorMessage=function(){h.errorMessage=null},g.admin?(h.processingGraders=!0,a.graders=d("/data/user/list").query({namesOnly:!0},function(){h.processingGraders=!1},function(a){h.processingGraders=!1,h.errorMessage=a&&a.message?a.message:"We had trouble listing the graders. Please close the modal and try again."})):i.grader=g._id,h.processingRubrics=!0,k=a.rubrics=d("/data/rubric/list").query({},function(){h.processingRubrics=!1;for(var b=0,c=k.length;b<c;b++)if(k[b]._id.toString()===f.rubric._id.toString()){j=a.rubric=k[b];break}},function(a){h.processingRubrics=!1,h.errorMessage=a&&a.message?a.message:"We had trouble getting the list of rubrics. Please close the modal and try again."}),a.showAll=function(){h.showAll=!0;for(var a=0,b=j.fields.length;a<b;a++)j.fields[a].visible=!0},a.hideAll=function(){h.showAll=!1;for(var a=0,b=j.fields.length;a<b;a++)j.fields[a].visible=!1},a.scoreField=function(a,b,c){i.score[b]=c,j.fields[a].visible=!1,h.clicked=!1;a:{for(var d=0,e=j.fields.length;d<e;d++)if(!i.score[j.fields[d].name]){h.formValid=!1;break a}h.formValid=!0}},a.editField=function(a){j.fields[a].visible=!0},a.click=function(){return h.clicked=!0,!0},a.save=function(){h.formValid&&(h.processing=!0,console.log(JSON.stringify(i,null,4)),i.scoresheet=i._id,delete i._id,c.put("data/scoresheet",i).success(function(a){h.processing=!1,a.user=g,a.rubric=j,b.close(a)}).error(function(a){h.processing=!1,h.errorMessage=a&&a.message?a.message:"We had trouble saving your score sheet. Please try again."}))},a.$watch("params.rubric",function(b,c){if(b!==c)for(var d=0,e=k.length;d<e;d++)if(b._id===k[d]._id){j=a.rubric=k[d];break}})}]),angular.module("app").controller("GradedWorkPreviewController",["$scope","$uibModalInstance","scoresheet",function(a,b,c){a.scoresheet=c;var d=a.fields=[];for(var e in c.score)c.score.hasOwnProperty(e)&&d.indexOf(e)<0&&d.push(e);a.cancel=function(){b.dismiss()}}]),angular.module("app").controller("GradersController",["$scope","$resource","$http","$timeout","$uibModal","CurrentUser",function(a,b,c,d,e,f){var g=a.user=f.data,h=a.status={},i=(a.params={},a.errorMessages=[]),j=a.successMessages=[];a.fields=g.admin?["no","id","name","email","graded essays","check scores","facilitator","admin"]:["no","id","name","email","graded essays","check scores"];a.closeErrorMessage=function(a){i.splice(a,1)},a.closeSuccessMessage=function(a){j.splice(a,1)},h.processing=!0;var k=a.graders=b("data/grader/list").query({},function(){h.processing=!1},function(a){h.processing=!1,i.push(a&&a.message?a.message:"Error! Could not list graders. Please try refreshing the page.")});a.newGrader=function(a){var b=e.open({templateUrl:"modules/main/graders/create/view.html",controller:"GradersCreateController",backdrop:"static"});b.result.then(function(a){k.push(a)},function(a){console.log(a||"dismiss")})},a.editGrader=function(a){console.log("edit grader")}}]),angular.module("app").controller("GradersCreateController",["$scope","$uibModalInstance","$http","$resource",function(a,b,c,d){var e=a.status={},f=a.params={};a.emailRegex=/.*\@.*\..*/;a.cancel=function(){b.dismiss("cancel")},a.closeErrorMessage=function(){e.errorMessage=null},a.click=function(){return e.clicked=!0,!0},a.save=function(){e.clicked=!0,e.processing=!0,c.post("data/grader",f).success(function(a){e.processing=!1,b.close(a)}).error(function(a){e.processing=!1,e.errorMessage=a&&a.message?a.message:"We had trouble registering you. Please try again."})}}]),angular.module("app").controller("HomeController",["$scope","CurrentUser",function(a,b){a.user=b.data}]),angular.module("app").controller("UserController",["$scope","$http","$resource","$state","$location","CurrentUser",function(a,b,c,d,e,f){var g=a.user={},h=a.status={},i=a.params={},j=a.groups=[];a.emailRegex=/.*\@.*\..*/,a.passwordRegex=/.{6}/;if(a.$on("$stateChangeStart",function(a,b,c,d,e){[h].forEach(function(a){for(var b in a)a.hasOwnProperty(b)&&delete a[b]}),g.password=null}),a.closeErrorMessage=function(){h.errorMessage=null},a.closeSuccessMessage=function(){h.successMessage=null},a.goToSignUp=function(){h.errorMessage=null,h.clicked=!1,d.go("user.signup")},a.toggleFacilitator=function(){g.facilitator=!g.facilitator},a.toggleShowPassword=function(){h.showPassword=!h.showPassword},h.processingGroups=!0,j=a.groups=c("data/group/list").query({},function(){h.processingGroups=!1},function(a){h.processingGroups=!1,h.errorMessage=a&&a.message?a.message:"We had trouble listing the groups. Please try refreshing the page."}),a.selectGroup=function(a){if(g.group=a,a.modules){var b=[];a.modules.forEach(function(a){a._id&&b.push(a._id)}),g.group.modules=b}h.showGroups=!1},a.click=function(){return h.clicked=!0,!0},a.signUp=function(){h.errorMessage=null,h.processing=!0,console.log(g),b.post("/data/user/sign-up",g).success(function(a){h.processing=!1,f.data=angular.extend(f.data,a),d.go("welcome")}).error(function(a){h.processing=!1,h.errorMessage=a&&a.message?a.message:"We had trouble signing you up. Please try again."})},a.goToLogin=function(){h.errorMessage=null,h.clicked=!1,d.go("user.login")},a.login=function(){h.errorMessage=null,h.processing=!0,b.post("/data/user/login",g).success(function(a){h.processing=!1,f.data=angular.extend(f.data,a),d.go("welcome")}).error(function(a){h.processing=!1,h.errorMessage=a&&a.message?a.message:"We had trouble logging you in. Please try again.";
})},a.goToForgotPassword=function(){h.errorMessage=null,h.clicked=!1,d.go("user.forgotpassword")},a.sendPasswordResetLink=function(){h.successMessage=null,h.errorMessage=null,h.processing=!0,b.post("/data/user/forgot-password",g).success(function(){h.processing=!1,h.successMessage="Reset link sent. Check your email.",console.log(h)}).error(function(a){h.processing=!1,h.errorMessage=a&&a.message?a.message:"We had trouble sending you a password reset email. Please try again."})},d.is("user.resetpassword")){var k=e.search();g.email=k.email,g.passwordResetCode=k.code,e.search("email",null),e.search("code",null),g.email&&g.passwordResetCode||(h.errorMessage="Reset link error. Please try clicking the link again.")}a.resetPassword=function(){h.processing=!0,b.post("/data/user/reset-password",g).success(function(){h.processing=!1,h.successMessage="login"}).error(function(a){h.processing=!1,h.errorMessage=a&&a.message?a.message:"We had trouble resetting your password. Please try again."})};var l;d.is("user.settings")&&(h.errorMessage=null,h.processing=!0,g=a.user=c("data/user/settings").get(function(){h.processing=!1,l=a.fullUser=angular.copy(g)},function(a){h.processing=!1,h.errorMessage="We had trouble retrieving your settings information. Please try again.",console.log(a)})),a.updateSettings=function(){return h.successMessage=null,h.errorMessage=null,l.firstName!==g.firstName&&(i.firstName=l.firstName),l.lastName!==g.lastName&&(i.lastName=l.lastName),l.email!==g.email&&(i.email=l.email),l.newPassword&&!l.password?void(h.errorMessage="Please provide your current password if you want to set a new password."):(l.newPassword&&l.password&&(i.newPassword=l.newPassword,i.password=l.password),h.processing=!0,void b.put("/data/user/settings",i).success(function(){h.processing=!1,h.successMessage="Settings Updated",l.newPassword=null,l.password=null}).error(function(a){h.processing=!1,h.errorMessage=a&&a.message?a.message:"We had trouble updating your settings. Please try again"}))}}]),angular.module("app").controller("WelcomeController",["$scope",function(a){}]);
//# sourceMappingURL=app.min.js.map